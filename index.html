<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pooja's Blog</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.js"></script>
  
  <!-- React and ReactDOM -->
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  
  <!-- Babel for JSX -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.21.2/babel.min.js"></script>
  
  <!-- Feather Icons -->
  <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
  
  <style>
    /* Fix for modals on mobile */
    .modal-scrollable {
      max-height: 90vh;
      overflow-y: auto;
    }
    
    /* Icon styles */
    .feather {
      width: 24px;
      height: 24px;
      stroke: currentColor;
      stroke-width: 2;
      stroke-linecap: round;
      stroke-linejoin: round;
      fill: none;
    }
    
    .feather-sm {
      width: 16px;
      height: 16px;
    }
    
    .feather-lg {
      width: 48px;
      height: 48px;
    }
  </style>
</head>
<body class="bg-gray-100">
  <div id="root"></div>

  <script type="text/babel">
    // Destructure required components from React
    const { useState, useEffect } = React;
    
    // Storage helper with fallback to memory storage when localStorage is unavailable
    const storage = {
      data: {},
      
      isAvailable: () => {
        try {
          const testKey = "__storage_test__";
          window.localStorage.setItem(testKey, testKey);
          window.localStorage.removeItem(testKey);
          return true;
        } catch(e) {
          console.log("localStorage is not available, using in-memory storage instead");
          return false;
        }
      },
      
      getItem: (key) => {
        try {
          if (storage.isAvailable()) {
            return window.localStorage.getItem(key);
          }
          return storage.data[key] || null;
        } catch (e) {
          return storage.data[key] || null;
        }
      },
      
      setItem: (key, value) => {
        try {
          if (storage.isAvailable()) {
            window.localStorage.setItem(key, value);
          }
          storage.data[key] = value;
        } catch (e) {
          storage.data[key] = value;
        }
      }
    };
    
    // Custom Icon component using Feather icons
    const Icon = ({ name, size = 24, className = "" }) => {
      const sizeClass = size === 48 ? "feather-lg" : size === 16 ? "feather-sm" : "";
      const fullClass = `feather feather-${name} ${sizeClass} ${className}`;
      
      useEffect(() => {
        // Replace the icon element with Feather SVG
        if (window.feather) {
          feather.replace();
        }
      }, []);
      
      return <i data-feather={name} className={fullClass}></i>;
    };

    const PoojasBlog = () => {
      const [showCreatePost, setShowCreatePost] = useState(false);
      const [showViewPost, setShowViewPost] = useState(false);
      const [showEditPost, setShowEditPost] = useState(false);
      const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);
      const [postToDelete, setPostToDelete] = useState(null);
      const [posts, setPosts] = useState(() => {
        // Load posts from storage on initial render
        const savedPosts = storage.getItem('poojaBlogPosts');
        return savedPosts ? JSON.parse(savedPosts) : [];
      });
      const [newPost, setNewPost] = useState({
        title: '',
        content: '',
        image: null
      });
      const [currentPost, setCurrentPost] = useState(null);
      const [editPost, setEditPost] = useState({
        id: null,
        title: '',
        content: '',
        image: null
      });
      
      // Initialize feather icons when component mounts
      useEffect(() => {
        if (window.feather) {
          feather.replace();
        }
      }, []);
      
      // Refresh feather icons when posts change or modals open/close
      useEffect(() => {
        if (window.feather) {
          feather.replace();
        }
      }, [posts, showCreatePost, showViewPost, showEditPost, showDeleteConfirm]);
      
      // Save posts to storage whenever they change
      useEffect(() => {
        storage.setItem('poojaBlogPosts', JSON.stringify(posts));
      }, [posts]);

      const handleCreatePost = () => {
        if (newPost.title.trim() === '' || newPost.content.trim() === '') {
          return;
        }

        const post = {
          id: Date.now(),
          title: newPost.title,
          content: newPost.content,
          date: new Date().toLocaleDateString(),
          image: newPost.image
        };

        setPosts([post, ...posts]);
        setNewPost({ title: '', content: '', image: null });
        setShowCreatePost(false);
      };
      
      const handleViewPost = (post) => {
        setCurrentPost(post);
        setShowViewPost(true);
      };
      
      const handleEditClick = (post) => {
        setEditPost({
          id: post.id,
          title: post.title,
          content: post.content,
          image: post.image
        });
        setShowEditPost(true);
      };
      
      const handleUpdatePost = () => {
        if (editPost.title.trim() === '' || editPost.content.trim() === '') {
          return;
        }
        
        const updatedPosts = posts.map(post => 
          post.id === editPost.id ? 
          { ...post, title: editPost.title, content: editPost.content, image: editPost.image } : 
          post
        );
        
        setPosts(updatedPosts);
        setShowEditPost(false);
      };
      
      const handleImageUpload = (e, isEdit = false) => {
        const file = e.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = () => {
          if (isEdit) {
            setEditPost({...editPost, image: reader.result});
          } else {
            setNewPost({...newPost, image: reader.result});
          }
        };
        reader.readAsDataURL(file);
      };

      const handleDeletePost = (id) => {
        // Using a custom confirmation dialog for better UX
        setPostToDelete(id);
        setShowDeleteConfirm(true);
      };

      return (
        <div className="min-h-screen bg-gray-100 p-6">
          <div className="max-w-4xl mx-auto">
            {/* Header */}
            <header className="bg-white rounded-lg shadow-md p-6 mb-6">
              <div className="flex flex-col sm:flex-row justify-between items-center">
                <h1 className="text-3xl font-bold text-purple-800 mb-4 sm:mb-0">Welcome to Pooja's Blog</h1>
                <button 
                  onClick={() => setShowCreatePost(!showCreatePost)}
                  className="flex items-center gap-2 bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors"
                >
                  <Icon name="plus-circle" />
                  <span>Create New Post</span>
                </button>
              </div>
            </header>

            {!storage.isAvailable() && (
              <div className="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-6 rounded" role="alert">
                <p className="font-bold">Note:</p>
                <p>This blog is running in a restricted environment. Your posts will only be saved for this session and will not persist when you close the browser.</p>
              </div>
            )}

            {/* Create Post Form */}
            {showCreatePost && (
              <div className="bg-white rounded-lg shadow-md p-6 mb-6">
                <h2 className="text-xl font-semibold mb-4 text-purple-800">Create New Post</h2>
                <div className="space-y-4">
                  <div>
                    <label htmlFor="title" className="block text-sm font-medium text-gray-700 mb-1">Title</label>
                    <input
                      type="text"
                      id="title"
                      className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                      value={newPost.title}
                      onChange={(e) => setNewPost({...newPost, title: e.target.value})}
                      placeholder="Enter post title"
                    />
                  </div>
                  <div>
                    <label htmlFor="content" className="block text-sm font-medium text-gray-700 mb-1">Content</label>
                    <textarea
                      id="content"
                      rows={6}
                      className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                      value={newPost.content}
                      onChange={(e) => setNewPost({...newPost, content: e.target.value})}
                      placeholder="Write your post content here..."
                    />
                  </div>
                  <div>
                    <label htmlFor="image" className="block text-sm font-medium text-gray-700 mb-1">
                      Add Image (optional)
                    </label>
                    <div className="flex items-center space-x-2">
                      <label className="flex items-center px-4 py-2 bg-white border border-gray-300 rounded-md cursor-pointer hover:bg-gray-50">
                        <Icon name="camera" className="mr-2 text-gray-500" />
                        <span className="text-sm text-gray-600">Choose Image</span>
                        <input
                          type="file"
                          id="image"
                          className="hidden"
                          accept="image/*"
                          onChange={(e) => handleImageUpload(e)}
                        />
                      </label>
                      {newPost.image && (
                        <button
                          onClick={() => setNewPost({...newPost, image: null})}
                          className="text-xs text-red-500 hover:text-red-700"
                        >
                          Remove
                        </button>
                      )}
                    </div>
                    {newPost.image && (
                      <div className="mt-2">
                        <img 
                          src={newPost.image} 
                          alt="Post preview" 
                          className="max-h-48 rounded-md border border-gray-200" 
                        />
                      </div>
                    )}
                  </div>
                  <div className="flex justify-end gap-3">
                    <button 
                      onClick={() => setShowCreatePost(false)}
                      className="px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-100"
                    >
                      Cancel
                    </button>
                    <button 
                      onClick={handleCreatePost}
                      className="px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700"
                    >
                      Publish
                    </button>
                  </div>
                </div>
              </div>
            )}

            {/* Blog Posts */}
            <div className="space-y-6">
              {posts.length > 0 ? (
                posts.map(post => (
                  <div key={post.id} className="bg-white rounded-lg shadow-md p-6">
                    <h2 className="text-2xl font-bold mb-2 text-purple-800">{post.title}</h2>
                    <div className="flex items-center gap-4 text-sm text-gray-500 mb-4">
                      <div className="flex items-center">
                        <Icon name="calendar" size={16} className="mr-1" />
                        <span>{post.date}</span>
                      </div>
                      <div className="flex items-center">
                        <Icon name="user" size={16} className="mr-1" />
                        <span>Pooja</span>
                      </div>
                    </div>
                    
                    {post.image && (
                      <div className="mb-4">
                        <img 
                          src={post.image} 
                          alt={post.title} 
                          className="max-h-64 rounded-md mx-auto" 
                        />
                      </div>
                    )}
                    
                    <p className="text-gray-700 whitespace-pre-line">
                      {post.content.length > 200 
                        ? post.content.substring(0, 200) + '...' 
                        : post.content}
                    </p>
                    
                    {/* Post Actions */}
                    <div className="flex flex-wrap gap-3 mt-4 pt-3 border-t border-gray-100">
                      <button 
                        onClick={() => handleViewPost(post)}
                        className="flex items-center gap-1 text-blue-600 hover:text-blue-800"
                      >
                        <Icon name="eye" size={16} />
                        <span>View</span>
                      </button>
                      <button 
                        onClick={() => handleEditClick(post)}
                        className="flex items-center gap-1 text-green-600 hover:text-green-800"
                      >
                        <Icon name="edit" size={16} />
                        <span>Edit</span>
                      </button>
                      <button 
                        onClick={() => handleDeletePost(post.id)}
                        className="flex items-center gap-1 text-red-600 hover:text-red-800"
                      >
                        <Icon name="trash-2" size={16} />
                        <span>Delete</span>
                      </button>
                    </div>
                  </div>
                ))
              ) : (
                <div className="bg-white rounded-lg shadow-md p-12 text-center">
                  <Icon name="book-open" size={48} className="mx-auto text-purple-300 mb-4" />
                  <h3 className="text-xl font-medium text-gray-700 mb-2">No posts yet</h3>
                  <p className="text-gray-500">Click "Create New Post" to start writing your first blog post.</p>
                </div>
              )}
            </div>
            
            {/* View Post Modal */}
            {showViewPost && currentPost && (
              <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                <div className="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-screen overflow-y-auto modal-scrollable">
                  <div className="flex justify-between items-center p-4 border-b">
                    <h2 className="text-xl font-semibold text-purple-800">View Post</h2>
                    <button 
                      onClick={() => setShowViewPost(false)} 
                      className="text-gray-500 hover:text-gray-700"
                    >
                      <Icon name="x" />
                    </button>
                  </div>
                  <div className="p-6">
                    <h3 className="text-2xl font-bold mb-2">{currentPost.title}</h3>
                    <div className="flex items-center gap-4 text-sm text-gray-500 mb-4">
                      <div className="flex items-center">
                        <Icon name="calendar" size={16} className="mr-1" />
                        <span>{currentPost.date}</span>
                      </div>
                      <div className="flex items-center">
                        <Icon name="user" size={16} className="mr-1" />
                        <span>Pooja</span>
                      </div>
                    </div>
                    
                    {currentPost.image && (
                      <div className="mb-6">
                        <img 
                          src={currentPost.image} 
                          alt={currentPost.title} 
                          className="max-w-full rounded-md mx-auto" 
                        />
                      </div>
                    )}
                    
                    <div className="prose max-w-none mt-4">
                      <p className="whitespace-pre-line">{currentPost.content}</p>
                    </div>
                  </div>
                  <div className="flex justify-end gap-3 p-4 border-t">
                    <button 
                      onClick={() => setShowViewPost(false)}
                      className="px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-100"
                    >
                      Close
                    </button>
                  </div>
                </div>
              </div>
            )}
            
            {/* Edit Post Modal */}
            {showEditPost && (
              <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                <div className="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-screen overflow-y-auto modal-scrollable">
                  <div className="flex justify-between items-center p-4 border-b">
                    <h2 className="text-xl font-semibold text-purple-800">Edit Post</h2>
                    <button 
                      onClick={() => setShowEditPost(false)} 
                      className="text-gray-500 hover:text-gray-700"
                    >
                      <Icon name="x" />
                    </button>
                  </div>
                  <div className="p-6">
                    <div className="space-y-4">
                      <div>
                        <label htmlFor="edit-title" className="block text-sm font-medium text-gray-700 mb-1">Title</label>
                        <input
                          type="text"
                          id="edit-title"
                          className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                          value={editPost.title}
                          onChange={(e) => setEditPost({...editPost, title: e.target.value})}
                        />
                      </div>
                      <div>
                        <label htmlFor="edit-content" className="block text-sm font-medium text-gray-700 mb-1">Content</label>
                        <textarea
                          id="edit-content"
                          rows={8}
                          className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                          value={editPost.content}
                          onChange={(e) => setEditPost({...editPost, content: e.target.value})}
                        />
                      </div>
                      <div>
                        <label htmlFor="edit-image" className="block text-sm font-medium text-gray-700 mb-1">
                          Image
                        </label>
                        <div className="flex items-center space-x-2">
                          <label className="flex items-center px-4 py-2 bg-white border border-gray-300 rounded-md cursor-pointer hover:bg-gray-50">
                            <Icon name="camera" className="mr-2 text-gray-500" />
                            <span className="text-sm text-gray-600">
                              {editPost.image ? 'Change Image' : 'Add Image'}
                            </span>
                            <input
                              type="file"
                              id="edit-image"
                              className="hidden"
                              accept="image/*"
                              onChange={(e) => handleImageUpload(e, true)}
                            />
                          </label>
                          {editPost.image && (
                            <button
                              onClick={() => setEditPost({...editPost, image: null})}
                              className="text-xs text-red-500 hover:text-red-700"
                            >
                              Remove
                            </button>
                          )}
                        </div>
                        {editPost.image && (
                          <div className="mt-2">
                            <img 
                              src={editPost.image} 
                              alt="Post preview" 
                              className="max-h-48 rounded-md border border-gray-200" 
                            />
                          </div>
                        )}
                      </div>
                    </div>
                  </div>
                  <div className="flex justify-end gap-3 p-4 border-t">
                    <button 
                      onClick={() => setShowEditPost(false)}
                      className="px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-100"
                    >
                      Cancel
                    </button>
                    <button 
                      onClick={handleUpdatePost}
                      className="px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700"
                    >
                      Save Changes
                    </button>
                  </div>
                </div>
              </div>
            )}
            
            {/* Delete Confirmation Modal */}
            {showDeleteConfirm && (
              <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                <div className="bg-white rounded-lg shadow-xl max-w-md w-full">
                  <div className="p-6">
                    <div className="flex items-center justify-center text-red-500 mb-4">
                      <Icon name="trash-2" size={48} />
                    </div>
                    <h3 className="text-xl font-bold text-center mb-2">Delete Post</h3>
                    <p className="text-gray-600 text-center mb-6">
                      Are you sure you want to delete this post? This action cannot be undone.
                    </p>
                    <div className="flex justify-center gap-4">
                      <button 
                        onClick={() => setShowDeleteConfirm(false)}
                        className="px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-100"
                      >
                        Cancel
                      </button>
                      <button 
                        onClick={() => {
                          const filteredPosts = posts.filter(post => post.id !== postToDelete);
                          setPosts(filteredPosts);
                          setShowDeleteConfirm(false);
                          
                          // Close any open modals if they were showing the deleted post
                          if (showViewPost && currentPost && currentPost.id === postToDelete) {
                            setShowViewPost(false);
                          }
                          if (showEditPost && editPost.id === postToDelete) {
                            setShowEditPost(false);
                          }
                        }}
                        className="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700"
                      >
                        Delete
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            )}
          </div>
        </div>
      );
    };

    // Render the app
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<PoojasBlog />);
  </script>
</body>
</html>
