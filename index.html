// Add this to your existing JavaScript

// Function to handle category navigation
function navigateToCategory(categoryName) {
  // Hide all content sections
  document.querySelector('.homepage').style.display = 'none';
  document.querySelector('.editor-section').style.display = 'none';
  
  // Check if category page already exists, if not create it
  let categoryPage = document.querySelector(`.category-page[data-category="${categoryName}"]`);
  
  if (!categoryPage) {
    // Create new category page if it doesn't exist
    categoryPage = document.createElement('section');
    categoryPage.className = 'category-page';
    categoryPage.setAttribute('data-category', categoryName);
    
    // Set the HTML content for the category page
    categoryPage.innerHTML = `
      <div class="container">
        <h2 class="section-title">${formatCategoryName(categoryName)} Posts</h2>
        <div class="posts-grid" id="${categoryName}-posts">
          <!-- Posts will be loaded here -->
          <div class="loading-indicator">Loading ${formatCategoryName(categoryName)} posts...</div>
        </div>
      </div>
    `;
    
    // Append to the content wrapper
    document.querySelector('.content-wrapper').appendChild(categoryPage);
    
    // Load posts for this category (simulated)
    setTimeout(() => loadCategoryPosts(categoryName), 500);
  }
  
  // Show this category page
  categoryPage.style.display = 'block';
  
  // Update active state in sidebar menu
  updateActiveSidebarItem(categoryName);
}

// Format category name for display (capitalize, replace hyphens with spaces)
function formatCategoryName(categoryName) {
  return categoryName
    .split('-')
    .map(word => word.charAt(0).toUpperCase() + word.slice(1))
    .join(' ');
}

// Update active state in sidebar
function updateActiveSidebarItem(categoryName) {
  // Remove active class from all sidebar menu items
  document.querySelectorAll('.sidebar-menu-link').forEach(item => {
    item.classList.remove('active');
  });
  
  // Add active class to the matching category item
  const menuItem = document.querySelector(`.sidebar-menu-link[data-category="${categoryName}"]`);
  if (menuItem) {
    menuItem.classList.add('active');
  }
}

// Simulate loading posts for a category
function loadCategoryPosts(categoryName) {
  const postsContainer = document.getElementById(`${categoryName}-posts`);
  
  // Clear loading indicator
  postsContainer.innerHTML = '';
  
  // Sample post data (in a real app, this would come from an API or database)
  const posts = {
    'daily-stories': [
      {
        id: 101,
        title: 'Morning Reflections',
        excerpt: 'The sunrise today reminded me of how beautiful simplicity can be...',
        image: '/api/placeholder/400/200',
        date: 'April 8, 2025',
        readTime: '3 min read',
        category: 'Daily Story'
      },
      {
        id: 102,
        title: 'A Day at the Park',
        excerpt: 'Sometimes all you need is fresh air and the sound of children playing...',
        image: '/api/placeholder/400/200',
        date: 'April 6, 2025',
        readTime: '4 min read',
        category: 'Daily Story'
      },
      {
        id: 103,
        title: 'The Unexpected Encounter',
        excerpt: 'Sometimes the most memorable moments happen when we least expect them...',
        image: '/api/placeholder/400/200',
        date: 'April 5, 2025',
        readTime: '5 min read',
        category: 'Daily Story'
      }
    ],
    'novels': [
      {
        id: 201,
        title: 'Whispers in the Shadows - Chapter 3',
        excerpt: 'As Maria approached the abandoned house, the whispers grew louder...',
        image: '/api/placeholder/400/200',
        date: 'April 7, 2025',
        readTime: '12 min read',
        category: 'Novel Chapter'
      },
      {
        id: 202,
        title: 'Whispers in the Shadows - Chapter 2',
        excerpt: 'The detective examined the mysterious note left at the scene...',
        image: '/api/placeholder/400/200',
        date: 'April 4, 2025',
        readTime: '10 min read',
        category: 'Novel Chapter'
      },
      {
        id: 203,
        title: 'Whispers in the Shadows - Chapter 1',
        excerpt: 'The streets were empty that night, except for the whispers...',
        image: '/api/placeholder/400/200',
        date: 'April 2, 2025',
        readTime: '10 min read',
        category: 'Novel Chapter'
      }
    ],
    'study-tips': [
      {
        id: 301,
        title: 'Effective Note-Taking Strategies',
        excerpt: 'After years of struggling with information retention, I\'ve discovered these methods...',
        image: '/api/placeholder/400/200',
        date: 'March 28, 2025',
        readTime: '7 min read',
        category: 'Study Tips'
      },
      {
        id: 302,
        title: 'The Pomodoro Technique: A Game Changer',
        excerpt: 'How 25-minute focused sessions transformed my productivity...',
        image: '/api/placeholder/400/200',
        date: 'March 20, 2025',
        readTime: '6 min read',
        category: 'Study Tips'
      }
    ],
    'feelings': [
      {
        id: 401,
        title: 'Finding Peace in Chaos',
        excerpt: 'When everything seems overwhelming, here\'s how I find my center...',
        image: '/api/placeholder/400/200',
        date: 'April 1, 2025',
        readTime: '5 min read',
        category: 'Feelings & Reflections'
      },
      {
        id: 402,
        title: 'The Journey Home',
        excerpt: 'After years abroad, returning to my childhood town brought unexpected emotions...',
        image: '/api/placeholder/400/200',
        date: 'March 25, 2025',
        readTime: '8 min read',
        category: 'Feelings & Reflections'
      }
    ]
  };
  
  // Get posts for this category (or empty array if none)
  const categoryPosts = posts[categoryName] || [];
  
  if (categoryPosts.length === 0) {
    postsContainer.innerHTML = '<p class="no-posts">No posts found in this category yet.</p>';
    return;
  }
  
  // Create HTML for each post
  categoryPosts.forEach(post => {
    const postElement = document.createElement('div');
    postElement.className = 'post-card';
    postElement.setAttribute('data-id', post.id);
    
    postElement.innerHTML = `
      <div class="post-actions-menu">
        <button class="post-actions-toggle">‚ãÆ</button>
        <div class="post-actions-dropdown">
          <div class="post-action-item edit-post">
            <span class="post-action-icon">‚úèÔ∏è</span> Edit
          </div>
          <div class="post-action-item delete-post">
            <span class="post-action-icon">üóëÔ∏è</span> Delete
          </div>
          <div class="post-action-item share-post">
            <span class="post-action-icon">üîó</span> Share
          </div>
        </div>
      </div>
      <img src="${post.image}" alt="Blog post" class="post-image">
      <div class="post-content">
        <span class="post-category">${post.category}</span>
        <h3 class="post-title">${post.title}</h3>
        <p class="post-excerpt">${post.excerpt}</p>
        <div class="post-meta">
          <span>${post.date}</span>
          <span>${post.readTime}</span>
        </div>
      </div>
    `;
    
    postsContainer.appendChild(postElement);
  });
  
  // Reinitialize post action dropdowns
  initializePostActionsDropdowns();
}

// Initialize post actions dropdowns for dynamic content
function initializePostActionsDropdowns() {
  const actionToggles = document.querySelectorAll('.post-actions-toggle');
  
  actionToggles.forEach(toggle => {
    toggle.addEventListener('click', function(e) {
      e.stopPropagation();
      const dropdown = this.nextElementSibling;
      dropdown.classList.toggle('show');
    });
  });
  
  // Initialize edit and delete functionality for new posts
  document.querySelectorAll('.edit-post').forEach(btn => {
    btn.addEventListener('click', function() {
      const postId = this.closest('.post-card').getAttribute('data-id');
      showToast(`Editing post #${postId}`);
    });
  });
  
  document.querySelectorAll('.delete-post').forEach(btn => {
    btn.addEventListener('click', function() {
      const postId = this.closest('.post-card').getAttribute('data-id');
      const postCard = this.closest('.post-card');
      if (confirm(`Are you sure you want to delete post #${postId}?`)) {
        showToast(`Post #${postId} deleted successfully`);
        postCard.remove();
      }
    });
  });
}

// Add data-category attributes to sidebar menu items
document.addEventListener('DOMContentLoaded', function() {
  // Add data attributes to sidebar menu links
  const categoryLinks = [
    { selector: '.sidebar-menu-link:contains("Daily Stories")', category: 'daily-stories' },
    { selector: '.sidebar-menu-link:contains("Stories")', category: 'daily-stories' },
    { selector: '.sidebar-menu-link:contains("Novels")', category: 'novels' },
    { selector: '.sidebar-menu-link:contains("Study Tips")', category: 'study-tips' },
    { selector: '.sidebar-menu-link:contains("Feelings")', category: 'feelings' }
  ];
  
  // Custom contains selector function since :contains is not standard
  categoryLinks.forEach(link => {
    document.querySelectorAll('.sidebar-menu-link').forEach(el => {
      if (el.textContent.includes(link.selector.split(':contains("')[1].split('")')[0])) {
        el.setAttribute('data-category', link.category);
        
        // Add click event listener
        el.addEventListener('click', function(e) {
          e.preventDefault();
          navigateToCategory(link.category);
        });
      }
    });
  });
  
  // Add click event for category cards
  document.querySelectorAll('.category-card').forEach(card => {
    card.addEventListener('click', function() {
      const category = this.getAttribute('data-category');
      navigateToCategory(category);
    });
  });
  
  // Add navigation for home link
  document.querySelectorAll('.sidebar-menu-link:contains("Home")').forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      
      // Hide all other sections
      document.querySelectorAll('.category-page').forEach(page => {
        page.style.display = 'none';
      });
      document.querySelector('.editor-section').style.display = 'none';
      
      // Show homepage
      document.querySelector('.homepage').style.display = 'block';
      
      // Update active state
      updateActiveSidebarItem('home');
    });
    
    // Set data attribute for home
    link.setAttribute('data-category', 'home');
  });
});

// Add a simple CSS to ensure category pages have proper styling
const style = document.createElement('style');
style.textContent = `
  .category-page {
    display: none;
    padding: 40px 0;
    background-color: white;
  }
  
  .loading-indicator {
    text-align: center;
    padding: 20px;
    color: #777;
    font-style: italic;
  }
  
  .no-posts {
    text-align: center;
    padding: 30px;
    color: #666;
    font-style: italic;
  }
`;
document.head.appendChild(style);
